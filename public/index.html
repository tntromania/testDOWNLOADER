<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YT Downloader Fix</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <div class="card">
        <h1>YouTube & Shorts ğŸš€</h1>

        <div class="input-area">
            <input type="text" id="url" placeholder="LipeÈ™te link-ul aici (Ex: youtube.com/shorts/...)" autocomplete="off">
        </div>

        <div class="loader" id="loader">
            â³ Analizez... (DureazÄƒ 2-3 secunde)
        </div>

        <div class="results" id="results">
            <div class="video-header">
                <h2 id="vidTitle"></h2>
            </div>

            <div class="btn-grid" id="btnGrid">
            </div>

            <div class="text-grid">
                <div class="text-box">
                    <h3>ğŸ‡·ğŸ‡´ REZUMAT AI</h3>
                    <div class="content" id="translatedText"></div>
                </div>
                <div class="text-box">
                    <h3>ğŸ‡ºğŸ‡¸ TRANSCRIPT</h3>
                    <div class="content" id="originalText"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const urlInput = document.getElementById('url');
    const loader = document.getElementById('loader');
    const results = document.getElementById('results');
    let debounceTimer;

    urlInput.addEventListener('input', () => {
        clearTimeout(debounceTimer);
        const val = urlInput.value.trim();
        if (val.length > 5) {
            debounceTimer = setTimeout(() => {
                startProcess(val);
            }, 800);
        }
    });

    async function startProcess(url) {
        loader.style.display = 'block';
        results.style.display = 'none';
        document.getElementById('btnGrid').innerHTML = '';

        try {
            const res = await fetch(`/api/process?url=${encodeURIComponent(url)}`);
            const data = await res.json();

            if (data.error) throw new Error(data.error);

            // 1. Titlu
            document.getElementById('vidTitle').innerText = data.title;

            // 2. Butoane
            if (data.downloads && data.downloads.length > 0) {
                data.downloads.forEach(d => {
                    const a = document.createElement('a');
                    a.href = d.url;
                    a.className = `dl-btn ${d.type}`;
                    a.target = '_blank';
                    a.innerHTML = `DESCARCÄ‚ ${d.label}`;
                    document.getElementById('btnGrid').appendChild(a);
                });
            } else {
                document.getElementById('btnGrid').innerHTML = '<p style="color:orange">API-ul nu a gÄƒsit link-uri directe de download pentru acest video.</p>';
            }

            // 3. Texte
            document.getElementById('translatedText').textContent = data.transcript.translated;
            document.getElementById('originalText').textContent = data.transcript.original;

            results.style.display = 'block';

        } catch (e) {
            alert("Eroare: " + e.message);
        } finally {
            loader.style.display = 'none';
        }
    }
</script>
</body>
</html>