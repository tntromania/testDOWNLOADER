<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Turbo</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <div class="card">
        <h1>YouTube Turbo ğŸš€</h1>

        <div class="input-area">
            <input type="text" id="url" placeholder="LipeÈ™te link-ul YouTube aici (Video sau Shorts)..." autocomplete="off">
        </div>

        <div class="loader" id="loader">
            â³ Se analizeazÄƒ, descarcÄƒ È™i traduce...
        </div>

        <div class="results" id="results">
            <div class="video-header">
                <h2 id="vidTitle"></h2>
            </div>

            <div class="btn-grid" id="btnGrid">
            </div>

            <div class="text-grid">
                <div class="text-box">
                    <h3>ğŸ‡·ğŸ‡´ REZUMAT AI (ROMÃ‚NÄ‚)</h3>
                    <div class="content" id="translatedText"></div>
                </div>
                <div class="text-box">
                    <h3>ğŸ‡ºğŸ‡¸ TRANSCRIPT ORIGINAL</h3>
                    <div class="content" id="originalText"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const urlInput = document.getElementById('url');
    const loader = document.getElementById('loader');
    const results = document.getElementById('results');
    let debounceTimer;
    let lastUrl = '';

    urlInput.addEventListener('input', () => {
        clearTimeout(debounceTimer);
        const val = urlInput.value.trim();

        if (val.length > 10 && (val.includes('youtube.com') || val.includes('youtu.be')) && val !== lastUrl) {
            debounceTimer = setTimeout(() => {
                startProcess(val);
            }, 500); // Porneste la 0.5s dupa ce te opresti din scris
        }
    });

    async function startProcess(url) {
        lastUrl = url;
        loader.style.display = 'block';
        results.style.display = 'none';
        document.getElementById('btnGrid').innerHTML = ''; // Curata butoanele vechi

        try {
            const res = await fetch(`/api/process?url=${encodeURIComponent(url)}`);
            const data = await res.json();

            if (data.error) throw new Error(data.error);

            // 1. Titlu
            document.getElementById('vidTitle').innerText = data.title;

            // 2. Butoane Download
            if (data.downloads && data.downloads.length > 0) {
                data.downloads.forEach(d => {
                    const a = document.createElement('a');
                    a.href = d.url;
                    a.className = `dl-btn ${d.type}`;
                    a.target = '_blank';
                    a.innerHTML = d.type === 'video' ? `VIDEO ${d.quality}` : 'AUDIO MP3';
                    document.getElementById('btnGrid').appendChild(a);
                });
            } else {
                document.getElementById('btnGrid').innerHTML = '<span style="color:red">Download indisponibil</span>';
            }

            // 3. Transcripturi
            document.getElementById('translatedText').textContent = data.transcript.translated || "FÄƒrÄƒ traducere.";
            document.getElementById('originalText').textContent = data.transcript.original || "FÄƒrÄƒ transcript.";

            results.style.display = 'block';

        } catch (e) {
            alert("Eroare: " + e.message);
        } finally {
            loader.style.display = 'none';
        }
    }
</script>

</body>
</html>